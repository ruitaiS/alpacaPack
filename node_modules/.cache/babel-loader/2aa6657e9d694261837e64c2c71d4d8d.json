{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/home/ruitai/alpaca/frontend/src/Components/stream.js\";\n//Based on:\n//https://dev.to/finallynero/using-websockets-in-react-4fkp\nimport React, { Component } from \"react\";\n\nclass Stream extends Component {\n  constructor(props) {\n    super(props);\n    this.ws = new WebSocket('wss://socket.polygon.io/stocks');\n    this.state = {\n      key_id: props.key_id,\n      secret_key: props.secret_key,\n      ticker: props.ticker,\n      test: \"hi\"\n    }; //Bind this to its functions\n\n    this.click = this.click.bind(this);\n    this.mouseOver = this.mouseOver.bind(this);\n    this.mouseOut = this.mouseOut.bind(this);\n  } // instance of websocket connection as a class property\n  //Stocks Websocket\n\n\n  //Forex Websocket\n  //ws = new WebSocket('wss://socket.polygon.io/forex')\n  componentDidMount() {\n    this.ws.onopen = () => {\n      // on connecting, do nothing but log it to the console\n      console.log('connected');\n      let auth_data = {\n        \"action\": \"auth\",\n        \"params\": this.state.key_id\n      };\n      this.ws.send(JSON.stringify(auth_data)); //Make this generic\n\n      let listen_message = {\n        \"action\": \"subscribe\",\n        \"params\": \"T.\" + this.state.ticker\n      };\n      this.ws.send(JSON.stringify(listen_message));\n    };\n\n    this.ws.onmessage = evt => {\n      let data = JSON.parse(evt.data);\n      console.log(data[0].p);\n      this.setState({\n        price: data[0].p\n      });\n    };\n\n    this.ws.onclose = () => {\n      console.log('disconnected'); // automatically try to reconnect on connection loss\n    };\n  }\n\n  mouseOver() {\n    //Store current stream price\n    //We want this to only run once, and then stop updating\n    console.log(\"Mouseover\");\n    this.setState({\n      buyPrice: this.state.price\n    });\n  }\n\n  mouseOut() {\n    //Reset / remove buyPrice\n    console.log(\"MouseOut\");\n    this.setState({\n      buyPrice: null\n    });\n  }\n\n  click() {\n    //Place a limit order at the buyPrice\n    console.log(\"Clicked\");\n    this.mouseOver(); //this.setState({buyPrice: this.state.price})\n    //console.log(this.state.test)\n  }\n\n  render() {\n    let buttonText = this.state.price;\n    let health = 100;\n    let color = \"green\";\n\n    if (this.state.buyPrice != null) {\n      buttonText = this.state.buyPrice;\n      health = Math.abs(this.state.buyPrice - this.state.price) / this.state.price * 100;\n\n      if (this.state.buyPrice > this.state.price) {\n        color = \"red\";\n      }\n    }\n\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          width: health * 10,\n          backgroundColor: color\n        },\n        children: \"yo\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: this.state.price\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: this.click,\n          onMouseOver: this.mouseOver,\n          onMouseOut: this.mouseOut,\n          children: buttonText\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 103,\n          columnNumber: 22\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default Stream;","map":{"version":3,"sources":["/home/ruitai/alpaca/frontend/src/Components/stream.js"],"names":["React","Component","Stream","constructor","props","ws","WebSocket","state","key_id","secret_key","ticker","test","click","bind","mouseOver","mouseOut","componentDidMount","onopen","console","log","auth_data","send","JSON","stringify","listen_message","onmessage","evt","data","parse","p","setState","price","onclose","buyPrice","render","buttonText","health","color","Math","abs","width","backgroundColor"],"mappings":"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","sourcesContent":["//Based on:\n//https://dev.to/finallynero/using-websockets-in-react-4fkp\n\nimport React, { Component }from \"react\";\n\nclass Stream extends Component {\n    constructor(props){\n        super(props);\n        this.state = {\n            key_id: props.key_id,\n            secret_key: props.secret_key,\n            ticker: props.ticker,\n            test: \"hi\",\n        }\n\n        //Bind this to its functions\n        this.click = this.click.bind(this)\n        this.mouseOver = this.mouseOver.bind(this)\n        this.mouseOut = this.mouseOut.bind(this)\n    }\n\n    // instance of websocket connection as a class property\n\n    //Stocks Websocket\n    ws = new WebSocket('wss://socket.polygon.io/stocks')\n\n    //Forex Websocket\n    //ws = new WebSocket('wss://socket.polygon.io/forex')\n\n    componentDidMount() {\n        this.ws.onopen = () => {\n        // on connecting, do nothing but log it to the console\n        console.log('connected')\n        let auth_data = {\"action\":\"auth\",\"params\": this.state.key_id}\n    \n        this.ws.send(JSON.stringify(auth_data))\n\n        //Make this generic\n        let listen_message = {\"action\":\"subscribe\",\"params\":\"T.\"+this.state.ticker}\n\n        this.ws.send(JSON.stringify(listen_message))            \n\n\n        }\n\n        this.ws.onmessage = evt => {\n\n        let data = JSON.parse(evt.data)\n        console.log(data[0].p)\n\n        this.setState({price: data[0].p})\n        }\n\n        this.ws.onclose = () => {\n        console.log('disconnected')\n        // automatically try to reconnect on connection loss\n\n        }\n\n    }\n\n    mouseOver(){\n        //Store current stream price\n        //We want this to only run once, and then stop updating\n        console.log(\"Mouseover\")\n        this.setState({buyPrice: this.state.price})\n    }\n\n    mouseOut(){\n        //Reset / remove buyPrice\n        console.log(\"MouseOut\")\n        this.setState({buyPrice: null})\n    }\n\n    click(){\n        //Place a limit order at the buyPrice\n        console.log(\"Clicked\")\n        this.mouseOver()\n        //this.setState({buyPrice: this.state.price})\n        //console.log(this.state.test)\n\n\n    }\n\n\n\n    render(){\n        let buttonText = this.state.price\n        let health = 100\n        let color = \"green\"\n        if (this.state.buyPrice != null){\n            buttonText = this.state.buyPrice\n            health = (Math.abs(this.state.buyPrice - this.state.price) / this.state.price) * 100\n            if (this.state.buyPrice>this.state.price){\n                color = \"red\"\n            }\n        }\n\n        return(\n            <div>\n                <div style={{width: health*10, backgroundColor: color}}>yo</div>\n                <div>{this.state.price}</div>\n                <div><button onClick={this.click} onMouseOver={this.mouseOver} onMouseOut={this.mouseOut}>{buttonText}</button></div>\n            </div>)\n    }\n}\n\nexport default Stream;"]},"metadata":{},"sourceType":"module"}