{"ast":null,"code":"//Based on:\n//https://dev.to/finallynero/using-websockets-in-react-4fkp\n//Uses the Polygon websocket for trades rather than the alpaca one. Documentation here:\n//https://polygon.io/sockets\n//TODO: This will need different methods depending on which websocket is being used, since they all seem to have different formats and standards\n//For now just use the stocks endpoint to build everything out\nclass Stream {\n  //constructor(key_id, url, callback){\n  constructor(key_id, secret_key, polygonURL, alpacaURL, polygonCallback, alpacaCallback) {\n    this.polygon = new WebSocket(polygonURL); //Live Price Stream\n\n    this.alpaca = new WebSocket(alpacaURL); //Trade Status Updates Stream\n    //this.subscriptionList = [];\n    //Send Authentication Message On Open:\n    //TODO: Error handling on failure to authenticate        \n\n    this.polygon.onopen = () => {\n      console.log(\"Authenticating Price Stream\");\n      this.polygon.send(JSON.stringify({\n        \"action\": \"auth\",\n        \"params\": key_id\n      }));\n    };\n\n    this.alpaca.onopen = () => {\n      console.log(\"Authenticating Trade Updates Stream\");\n      this.alpaca.send(JSON.stringify({\n        \"action\": \"authenticate\",\n        \"data\": {\n          \"key_id\": key_id,\n          \"secret_key\": secret_key\n        }\n      }));\n    }; //TODO: Could I just use onmessage = callback(msg)?\n\n\n    this.polygon.onmessage = msg => {\n      polygonCallback(msg);\n    };\n\n    this.alpaca.onmessage = msg => {\n      let promise = msg.data.text();\n      promise.then(res => {\n        console.log(res);\n      }); //alpacaCallback(msg)\n    };\n\n    this.polygon.onclose = () => {\n      console.log(\"Disconnected from Price Stream\");\n    };\n\n    this.alpaca.onclose = () => {\n      console.log(\"Disconnected from Trade Updates Stream\");\n    };\n  } //For Trade Stream Only:\n\n\n  subscribe(ticker) {\n    this.polygon.send(JSON.stringify({\n      \"action\": \"subscribe\",\n      \"params\": \"T.\" + ticker\n    }));\n  }\n\n  unsubscribe(ticker) {\n    this.polygon.send(JSON.stringify({\n      \"action\": \"unsubscribe\",\n      \"params\": \"T.\" + ticker\n    }));\n  }\n\n  disconnect() {\n    this.polygon.close();\n    this.alpaca.close();\n  }\n\n}\n\nexport default Stream;","map":{"version":3,"sources":["/home/ruitai/alpaca/frontend/src/Components/stream.js"],"names":["Stream","constructor","key_id","secret_key","polygonURL","alpacaURL","polygonCallback","alpacaCallback","polygon","WebSocket","alpaca","onopen","console","log","send","JSON","stringify","onmessage","msg","promise","data","text","then","res","onclose","subscribe","ticker","unsubscribe","disconnect","close"],"mappings":"AAAA;AACA;AAEA;AACA;AAGA;AACA;AAEA,MAAMA,MAAN,CAAY;AACR;AACAC,EAAAA,WAAW,CAACC,MAAD,EAASC,UAAT,EAAqBC,UAArB,EAAiCC,SAAjC,EAA4CC,eAA5C,EAA6DC,cAA7D,EAA4E;AACnF,SAAKC,OAAL,GAAe,IAAIC,SAAJ,CAAcL,UAAd,CAAf,CADmF,CAC1C;;AACzC,SAAKM,MAAL,GAAc,IAAID,SAAJ,CAAcJ,SAAd,CAAd,CAFmF,CAE5C;AAGvC;AAEA;AACA;;AACA,SAAKG,OAAL,CAAaG,MAAb,GAAsB,MAAM;AACxBC,MAAAA,OAAO,CAACC,GAAR,CAAY,6BAAZ;AACA,WAAKL,OAAL,CAAaM,IAAb,CAAkBC,IAAI,CAACC,SAAL,CAAe;AAAC,kBAAS,MAAV;AAAiB,kBAAUd;AAA3B,OAAf,CAAlB;AACH,KAHD;;AAIA,SAAKQ,MAAL,CAAYC,MAAZ,GAAqB,MAAM;AACvBC,MAAAA,OAAO,CAACC,GAAR,CAAY,qCAAZ;AACA,WAAKH,MAAL,CAAYI,IAAZ,CAAiBC,IAAI,CAACC,SAAL,CAAe;AAAC,kBAAS,cAAV;AAAyB,gBAAQ;AAAC,oBAAUd,MAAX;AAAmB,wBAAaC;AAAhC;AAAjC,OAAf,CAAjB;AACH,KAHD,CAbmF,CAkBnF;;;AACA,SAAKK,OAAL,CAAaS,SAAb,GAAyBC,GAAG,IAAI;AAC5BZ,MAAAA,eAAe,CAACY,GAAD,CAAf;AACH,KAFD;;AAGA,SAAKR,MAAL,CAAYO,SAAZ,GAAwBC,GAAG,IAAI;AAC3B,UAAIC,OAAO,GAAGD,GAAG,CAACE,IAAJ,CAASC,IAAT,EAAd;AACAF,MAAAA,OAAO,CAACG,IAAR,CAAaC,GAAG,IAAI;AAChBX,QAAAA,OAAO,CAACC,GAAR,CAAYU,GAAZ;AACH,OAFD,EAF2B,CAK3B;AACH,KAND;;AAQA,SAAKf,OAAL,CAAagB,OAAb,GAAuB,MAAK;AACxBZ,MAAAA,OAAO,CAACC,GAAR,CAAY,gCAAZ;AACH,KAFD;;AAGA,SAAKH,MAAL,CAAYc,OAAZ,GAAsB,MAAK;AACvBZ,MAAAA,OAAO,CAACC,GAAR,CAAY,wCAAZ;AACH,KAFD;AAGH,GAtCO,CAwCR;;;AACAY,EAAAA,SAAS,CAACC,MAAD,EAAQ;AACb,SAAKlB,OAAL,CAAaM,IAAb,CAAkBC,IAAI,CAACC,SAAL,CAAe;AAAC,gBAAS,WAAV;AAAsB,gBAAS,OAAKU;AAApC,KAAf,CAAlB;AACH;;AAEDC,EAAAA,WAAW,CAACD,MAAD,EAAQ;AACf,SAAKlB,OAAL,CAAaM,IAAb,CAAkBC,IAAI,CAACC,SAAL,CAAe;AAAC,gBAAS,aAAV;AAAwB,gBAAS,OAAKU;AAAtC,KAAf,CAAlB;AACH;;AAEDE,EAAAA,UAAU,GAAE;AACR,SAAKpB,OAAL,CAAaqB,KAAb;AACA,SAAKnB,MAAL,CAAYmB,KAAZ;AACH;;AApDO;;AAuDZ,eAAe7B,MAAf","sourcesContent":["//Based on:\n//https://dev.to/finallynero/using-websockets-in-react-4fkp\n\n//Uses the Polygon websocket for trades rather than the alpaca one. Documentation here:\n//https://polygon.io/sockets\n\n\n//TODO: This will need different methods depending on which websocket is being used, since they all seem to have different formats and standards\n//For now just use the stocks endpoint to build everything out\n\nclass Stream{\n    //constructor(key_id, url, callback){\n    constructor(key_id, secret_key, polygonURL, alpacaURL, polygonCallback, alpacaCallback){\n        this.polygon = new WebSocket(polygonURL) //Live Price Stream\n        this.alpaca = new WebSocket(alpacaURL) //Trade Status Updates Stream\n\n\n        //this.subscriptionList = [];\n\n        //Send Authentication Message On Open:\n        //TODO: Error handling on failure to authenticate        \n        this.polygon.onopen = () => {\n            console.log(\"Authenticating Price Stream\")\n            this.polygon.send(JSON.stringify({\"action\":\"auth\",\"params\": key_id}))\n        }\n        this.alpaca.onopen = () => {\n            console.log(\"Authenticating Trade Updates Stream\")\n            this.alpaca.send(JSON.stringify({\"action\":\"authenticate\",\"data\": {\"key_id\": key_id, \"secret_key\":secret_key}}))\n        }\n\n        //TODO: Could I just use onmessage = callback(msg)?\n        this.polygon.onmessage = msg => {\n            polygonCallback(msg)\n        }\n        this.alpaca.onmessage = msg => {\n            let promise = msg.data.text()\n            promise.then(res => {\n                console.log(res)\n            })\n            //alpacaCallback(msg)\n        }\n\n        this.polygon.onclose = () =>{\n            console.log(\"Disconnected from Price Stream\")\n        }\n        this.alpaca.onclose = () =>{\n            console.log(\"Disconnected from Trade Updates Stream\")\n        }\n    }\n\n    //For Trade Stream Only:\n    subscribe(ticker){\n        this.polygon.send(JSON.stringify({\"action\":\"subscribe\",\"params\":\"T.\"+ticker}))\n    }\n\n    unsubscribe(ticker){\n        this.polygon.send(JSON.stringify({\"action\":\"unsubscribe\",\"params\":\"T.\"+ticker}))\n    }\n\n    disconnect(){\n        this.polygon.close()\n        this.alpaca.close()\n    }\n}\n\nexport default Stream;"]},"metadata":{},"sourceType":"module"}