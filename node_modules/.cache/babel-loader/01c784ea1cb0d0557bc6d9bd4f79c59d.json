{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/home/ruitai/alpaca/frontend/src/Components/stream.js\";\n//Based on:\n//https://dev.to/finallynero/using-websockets-in-react-4fkp\nimport { Component } from \"react\";\nimport PCTBar from './pctBar';\n\nclass Stream extends Component {\n  constructor(props) {\n    super(props); //key_id\n    //secret_key\n    //ticker\n    //fakePCT\n\n    this.ws = new WebSocket('wss://socket.polygon.io/stocks');\n    this.state = {\n      //currPrice\n      pct: null,\n      //Testing Buy / Sell Code\n      boughtAt: null,\n      soldAt: null,\n      pctGain: null\n    }; //Bind this to its functions\n\n    this.click = this.click.bind(this);\n    this.mouseOver = this.mouseOver.bind(this);\n    this.mouseOut = this.mouseOut.bind(this);\n  } //Stocks Websocket\n\n\n  //Forex Websocket\n  //ws = new WebSocket('wss://socket.polygon.io/forex')\n  componentDidMount() {\n    this.ws.onopen = () => {\n      console.log('connected');\n      let auth_data = {\n        \"action\": \"auth\",\n        \"params\": this.props.key_id\n      };\n      this.ws.send(JSON.stringify(auth_data));\n      let listen_message = {\n        \"action\": \"subscribe\",\n        \"params\": \"T.\" + this.props.ticker\n      };\n      this.ws.send(JSON.stringify(listen_message));\n    };\n\n    this.ws.onmessage = evt => {\n      let data = JSON.parse(evt.data); //console.log(data[0].p)\n\n      this.setState({\n        currPrice: data[0].p\n      });\n\n      if (this.state.buyPrice != null) {\n        //Inverted PCT\n        //Buy Price > Current Price = Green; You can buy the stock at (or cheaper) than you wanted\n        //Buy Price < Current Price = Red; The stock is more expeensive than your limit price & the order won't go through (immediately)\n        this.setState({\n          pct: (this.state.buyPrice - this.state.currPrice) / this.state.buyPrice\n        });\n      }\n    };\n\n    this.ws.onclose = () => {\n      console.log('disconnected'); // automatically try to reconnect on connection loss\n    };\n  }\n\n  mouseOver() {\n    //Store current stream price\n    //We want this to only run once, and then stop updating\n    console.log(\"Mouseover\");\n    this.setState({\n      buyPrice: this.state.currPrice\n    });\n  }\n\n  mouseOut() {\n    //Reset / remove buyPrice\n    console.log(\"MouseOut\");\n    this.setState({\n      pct: null\n    });\n    this.setState({\n      buyPrice: null\n    });\n  }\n\n  click() {\n    //Place a limit order at the buyPrice\n    console.log(\"Clicked\");\n    this.mouseOver(); //this.setState({buyPrice: this.state.price})\n    //console.log(this.state.test)\n  }\n\n  render() {\n    let buttonText;\n    let overText;\n\n    if (this.state.currPrice != null) {\n      overText = this.state.currPrice.toFixed(2);\n      buttonText = this.state.currPrice.toFixed(2);\n    }\n\n    if (this.state.buyPrice != null) {\n      buttonText = this.state.buyPrice.toFixed(2);\n    } //Use this.state.pct in place of this.props.fakePCT for live testing\n\n\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(PCTBar, {\n        maxWidth: \"270\",\n        pctChange: this.state.pctGain,\n        scale: \"1\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(PCTBar, {\n        maxWidth: \"270\",\n        pctChange: this.state.pct,\n        scale: \"1\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: overText\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          class: \"streamBtn\",\n          onClick: this.click,\n          onMouseOver: this.mouseOver,\n          onMouseOut: this.mouseOut,\n          children: buttonText\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 117,\n          columnNumber: 22\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default Stream;","map":{"version":3,"sources":["/home/ruitai/alpaca/frontend/src/Components/stream.js"],"names":["Component","PCTBar","Stream","constructor","props","ws","WebSocket","state","pct","boughtAt","soldAt","pctGain","click","bind","mouseOver","mouseOut","componentDidMount","onopen","console","log","auth_data","key_id","send","JSON","stringify","listen_message","ticker","onmessage","evt","data","parse","setState","currPrice","p","buyPrice","onclose","render","buttonText","overText","toFixed"],"mappings":"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","sourcesContent":["//Based on:\n//https://dev.to/finallynero/using-websockets-in-react-4fkp\n\nimport {Component} from \"react\";\nimport PCTBar from './pctBar';\n\nclass Stream extends Component {\n    constructor(props){\n        super(props);\n        //key_id\n        //secret_key\n        //ticker\n        //fakePCT\n        this.state = {\n            //currPrice\n            pct: null,\n\n\n            //Testing Buy / Sell Code\n            boughtAt: null,\n            soldAt: null,\n            pctGain: null,\n        }\n\n        //Bind this to its functions\n        this.click = this.click.bind(this)\n        this.mouseOver = this.mouseOver.bind(this)\n        this.mouseOut = this.mouseOut.bind(this)\n    }\n\n    //Stocks Websocket\n    ws = new WebSocket('wss://socket.polygon.io/stocks')\n\n    //Forex Websocket\n    //ws = new WebSocket('wss://socket.polygon.io/forex')\n\n    componentDidMount() {\n        this.ws.onopen = () => {\n        console.log('connected')\n\n        let auth_data = {\"action\":\"auth\",\"params\": this.props.key_id}\n        this.ws.send(JSON.stringify(auth_data))\n\n        let listen_message = {\"action\":\"subscribe\",\"params\":\"T.\"+this.props.ticker}\n        this.ws.send(JSON.stringify(listen_message))\n\n\n        }\n\n        this.ws.onmessage = evt => {\n\n        let data = JSON.parse(evt.data)\n        //console.log(data[0].p)\n\n        this.setState({currPrice: data[0].p})\n\n        if (this.state.buyPrice != null){\n        //Inverted PCT\n        //Buy Price > Current Price = Green; You can buy the stock at (or cheaper) than you wanted\n        //Buy Price < Current Price = Red; The stock is more expeensive than your limit price & the order won't go through (immediately)\n        this.setState({pct: (this.state.buyPrice-this.state.currPrice)/ this.state.buyPrice})\n        }\n\n        }\n\n        this.ws.onclose = () => {\n        console.log('disconnected')\n        // automatically try to reconnect on connection loss\n\n        }\n\n    }\n\n    mouseOver(){\n        //Store current stream price\n        //We want this to only run once, and then stop updating\n        console.log(\"Mouseover\")\n        this.setState({buyPrice: this.state.currPrice})\n    }\n\n    mouseOut(){\n        //Reset / remove buyPrice\n        console.log(\"MouseOut\")\n        this.setState({pct: null})\n        this.setState({buyPrice: null})\n    }\n\n    click(){\n        //Place a limit order at the buyPrice\n        console.log(\"Clicked\")\n        this.mouseOver()\n        //this.setState({buyPrice: this.state.price})\n        //console.log(this.state.test)\n\n\n    }\n\n    render(){\n        let buttonText\n        let overText\n        if (this.state.currPrice != null){\n            overText = this.state.currPrice.toFixed(2)\n            buttonText = this.state.currPrice.toFixed(2)\n        }\n\n        if (this.state.buyPrice != null){\n            buttonText = this.state.buyPrice.toFixed(2)\n        }\n\n\n        //Use this.state.pct in place of this.props.fakePCT for live testing\n        return(\n            <div>\n                <PCTBar maxWidth=\"270\" pctChange={this.state.pctGain} scale=\"1\"/>\n                <PCTBar maxWidth=\"270\" pctChange={this.state.pct} scale=\"1\"/>\n                <div>{overText}</div>\n                <div><button class=\"streamBtn\" onClick={this.click} onMouseOver={this.mouseOver} onMouseOut={this.mouseOut}>{buttonText}</button></div>\n            </div>)\n    }\n}\n\nexport default Stream;"]},"metadata":{},"sourceType":"module"}