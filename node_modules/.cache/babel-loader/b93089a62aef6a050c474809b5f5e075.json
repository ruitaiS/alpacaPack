{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/home/ruitai/alpaca/frontend/src/Components/main.js\";\nimport { Component } from \"react\";\nimport Control from './control';\nimport API from './apiHandler';\nimport Stream from \"./stream\";\nimport List from './list';\n\nclass Main extends Component {\n  constructor(props) {\n    super(props); //Values that get passed to the component\n\n    this.tickerChange = this.tickerChange.bind(this);\n    this.idChange = this.idChange.bind(this);\n    this.skChange = this.skChange.bind(this);\n    this.streamChange = this.streamChange.bind(this);\n    this.p1Change = this.p1Change.bind(this);\n    this.p2Change = this.p2Change.bind(this);\n    this.pairSwap = this.pairSwap.bind(this);\n    this.streamListener = this.streamListener.bind(this);\n    this.connect = this.connect.bind(this);\n    this.apiPositionListener = this.apiPositionListener.bind(this); //this.subscribe = this.subscribe.bind(this);\n    //this.unsubscribe = this.unsubscribe.bind(this);\n    //this.initPositions = this.initPositions.bind(this);\n    //this.get_price = this.get_price.bind(this);\n\n    this.positions = {}; // Symbol: [qty, price]\n\n    this.state = {\n      key_id: 'PK5YYD0RTSIBEH5O4IG7',\n      //key_id: 'bvqgf2n48v6qg460kck0',\n      secret_key: 'vbrBfUR0BkmsjtR13sB0mxqYOPQqaR67ARJoZO4P',\n      positions: null,\n      //array of [Ticker, qty, avg price] arrays\n      streamData: null,\n      //Data from the polygon stream\n      stream: 'stocks',\n      //stream: 'forex',\n      ticker: 'MSFT',\n      // Ticker is the active window ticker symbol\n      p1: \"USD\",\n      p2: \"CAD\"\n    };\n  } //#region Onchange Functions (Called from Control Panel)\n  //TODO: May need to update the websocket stream & also the api handler\n  //NOTE: Using this.state.[whatever] after setState doesn't seem to update it until the next iteration;\n  //Need to directly use e.target.value\n\n\n  tickerChange(e) {\n    this.setState({\n      ticker: e.target.value\n    });\n  }\n\n  idChange(e) {\n    this.setState({\n      key_id: e.target.value\n    });\n  }\n\n  skChange(e) {\n    this.setState({\n      secret_key: e.target.value\n    });\n  }\n\n  streamChange(e) {\n    //TODO -> What should the behavior here be wrt to the currently active connections?\n    this.setState({\n      stream: e.target.value\n    }); //this.disconnect()\n    //url state is updated in connect()\n  } //Currency Pair Related Functions\n\n\n  p1Change(e) {\n    this.setState({\n      p1: e.target.value\n    });\n  }\n\n  p2Change(e) {\n    this.setState({\n      p2: e.target.value\n    });\n  }\n\n  pairSwap() {\n    let p1Now = this.state.p1;\n    let p2Now = this.state.p2;\n    this.setState({\n      p1: p2Now\n    });\n    this.setState({\n      p2: p1Now\n    });\n  } //#endregion\n\n\n  streamListener(msg) {\n    //websocket callback; parses incoming data and updates state\n    let data = JSON.parse(msg.data);\n\n    if (data[0].message != null) {\n      console.log(data[0].message); //initialize positions after authentication confirmation\n\n      if (data[0].message === 'authenticated') {\n        //TODO: How to handle the active window?\n        //this.ws.subscribe(this.state.ticker)\n        //Get Position List After Websocket Confirm\n        //alert(\"Getting Positions\")\n        this.api.get_positions(msg => this.apiPositionListener(msg, true));\n      }\n    } else {\n      //Message is null, so we assume we're subscribed, and getting price data\n      //console.log(JSON.stringify(data))\n      //this.setState({streamData: data})\n      //Data from WS comes in Asynchronously, so we update the position dict\n      for (let datum of data) {\n        this.positions[datum.sym][\"price\"] = datum.p;\n      } //alert(\"Setting Positions\")\n\n\n      this.setState({\n        positions: this.positions\n      });\n    }\n  }\n\n  apiPositionListener(msg, firstRun) {\n    //alert(\"API position listener called\")\n    //After getting Alpaca positions list, subscribes to the necessary streams through polygon\n    for (let position of JSON.parse(msg)) {\n      //Price defaults to last day price; will get overwritten by WS stream if live\n      this.positions[position.symbol] = {\n        qty: position.qty,\n        cost: position.avg_entry_price,\n        price: position.lastday_price\n      };\n\n      if (firstRun) {\n        this.ws.subscribe(position.symbol);\n      }\n    }\n\n    this.setState({\n      positions: this.positions\n    });\n  }\n\n  updatePositions() {\n    this.api.get_positions(msg => this.apiPositionListener(msg, false));\n  }\n\n  connect() {\n    //Creates new connections to API and Stream\n    if (this.state.stream === \"stocks\") {\n      this.api = new API(this.state.key_id, this.state.secret_key, 'https://paper-api.alpaca.markets');\n      this.ws = new Stream(this.state.key_id, 'wss://socket.polygon.io/stocks', this.streamListener);\n    } else {\n      alert(\"Forex support coming soon!\");\n      this.setState({\n        stream: \"stocks\"\n      }); //this.ws = new Stream(this.state.key_id, `wss://ws.finnhub.io?token=${this.state.key_id}`, this.streamListener)\n      //this.api = null\n    }\n  }\n\n  disconnect() {//TODO\n    //this.ws.disconnect()\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(List, {\n        positions: this.state.positions,\n        api: this.api\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Control, {\n        key_id: this.state.key_id,\n        secret_key: this.state.secret_key,\n        ticker: this.state.ticker,\n        stream: this.state.stream,\n        p1: this.state.p1,\n        p2: this.state.p2,\n        idChange: this.idChange,\n        skChange: this.skChange,\n        tickerChange: this.tickerChange,\n        streamChange: this.streamChange,\n        p1Change: this.p1Change,\n        p2Change: this.p2Change,\n        pairSwap: this.pairSwap,\n        connect: this.connect\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 163,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default Main;","map":{"version":3,"sources":["/home/ruitai/alpaca/frontend/src/Components/main.js"],"names":["Component","Control","API","Stream","List","Main","constructor","props","tickerChange","bind","idChange","skChange","streamChange","p1Change","p2Change","pairSwap","streamListener","connect","apiPositionListener","positions","state","key_id","secret_key","streamData","stream","ticker","p1","p2","e","setState","target","value","p1Now","p2Now","msg","data","JSON","parse","message","console","log","api","get_positions","datum","sym","p","firstRun","position","symbol","qty","cost","avg_entry_price","price","lastday_price","ws","subscribe","updatePositions","alert","disconnect","render"],"mappings":"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","sourcesContent":["import {Component} from \"react\";\nimport Control from './control';\nimport API from './apiHandler';\nimport Stream from \"./stream\";\n\nimport List from './list';\n\nclass Main extends Component{\n    constructor(props){\n        super(props);\n        //Values that get passed to the component\n\n        this.tickerChange = this.tickerChange.bind(this);\n        this.idChange = this.idChange.bind(this);\n        this.skChange = this.skChange.bind(this);\n        this.streamChange = this.streamChange.bind(this);\n\n        this.p1Change = this.p1Change.bind(this);\n        this.p2Change = this.p2Change.bind(this);\n        this.pairSwap = this.pairSwap.bind(this);\n\n        this.streamListener = this.streamListener.bind(this);\n        this.connect = this.connect.bind(this);\n        this.apiPositionListener = this.apiPositionListener.bind(this);\n\n        //this.subscribe = this.subscribe.bind(this);\n        //this.unsubscribe = this.unsubscribe.bind(this);\n\n        //this.initPositions = this.initPositions.bind(this);\n        //this.get_price = this.get_price.bind(this);\n\n        this.positions = {} // Symbol: [qty, price]\n\n        this.state = {\n            key_id: 'PK5YYD0RTSIBEH5O4IG7',\n            //key_id: 'bvqgf2n48v6qg460kck0',\n            secret_key: 'vbrBfUR0BkmsjtR13sB0mxqYOPQqaR67ARJoZO4P',\n\n            \n            positions: null, //array of [Ticker, qty, avg price] arrays\n            streamData: null, //Data from the polygon stream\n\n            stream: 'stocks',\n            //stream: 'forex',\n            ticker: 'MSFT', // Ticker is the active window ticker symbol\n\n            p1: \"USD\",\n            p2: \"CAD\",\n        }\n    }\n\n    //#region Onchange Functions (Called from Control Panel)\n    //TODO: May need to update the websocket stream & also the api handler\n    //NOTE: Using this.state.[whatever] after setState doesn't seem to update it until the next iteration;\n    //Need to directly use e.target.value\n    tickerChange(e) {\n        this.setState({ticker: e.target.value})\n    }\n    idChange(e) {\n        this.setState({key_id: e.target.value});\n    }\n    skChange(e) {\n        this.setState({secret_key: e.target.value});\n    }\n\n    streamChange(e){\n        //TODO -> What should the behavior here be wrt to the currently active connections?\n        this.setState({stream: e.target.value})\n        //this.disconnect()\n\n        //url state is updated in connect()\n    }\n\n    //Currency Pair Related Functions\n    p1Change(e){\n        this.setState({p1: e.target.value})\n    }\n\n    p2Change(e){\n        this.setState({p2: e.target.value})\n    }\n\n    pairSwap(){\n        let p1Now = this.state.p1\n        let p2Now = this.state.p2\n        this.setState({p1: p2Now})\n        this.setState({p2: p1Now})\n    }\n    //#endregion\n\n    \n    streamListener(msg){ //websocket callback; parses incoming data and updates state\n        let data = JSON.parse(msg.data)\n        if (data[0].message != null){\n            console.log(data[0].message)\n            //initialize positions after authentication confirmation\n            if (data[0].message === 'authenticated'){\n                //TODO: How to handle the active window?\n                //this.ws.subscribe(this.state.ticker)\n\n                //Get Position List After Websocket Confirm\n                //alert(\"Getting Positions\")\n                this.api.get_positions((msg)=> this.apiPositionListener(msg, true)) \n            }\n        }else{//Message is null, so we assume we're subscribed, and getting price data\n            //console.log(JSON.stringify(data))\n            //this.setState({streamData: data})\n\n            //Data from WS comes in Asynchronously, so we update the position dict\n            for (let datum of data){\n                this.positions[datum.sym][\"price\"] = datum.p\n            }\n            //alert(\"Setting Positions\")\n            this.setState({positions: this.positions})\n        }\n    }\n\n    \n    apiPositionListener(msg, firstRun){\n        //alert(\"API position listener called\")\n\n        //After getting Alpaca positions list, subscribes to the necessary streams through polygon\n        for (let position of JSON.parse(msg)){\n            //Price defaults to last day price; will get overwritten by WS stream if live\n            this.positions[position.symbol] = {qty: position.qty, cost: position.avg_entry_price, price: position.lastday_price}\n            \n            if(firstRun){\n                this.ws.subscribe(position.symbol)\n            }\n        }\n\n        this.setState({positions: this.positions})\n    }\n\n    updatePositions(){\n        this.api.get_positions((msg)=> this.apiPositionListener(msg, false))\n    }\n\n    connect(){\n        //Creates new connections to API and Stream\n        if (this.state.stream === \"stocks\"){\n            this.api = new API(this.state.key_id, this.state.secret_key, 'https://paper-api.alpaca.markets')\n            this.ws = new Stream(this.state.key_id, 'wss://socket.polygon.io/stocks', this.streamListener)          \n        }else{\n            alert(\"Forex support coming soon!\")\n            this.setState({stream: \"stocks\"})\n            //this.ws = new Stream(this.state.key_id, `wss://ws.finnhub.io?token=${this.state.key_id}`, this.streamListener)\n            //this.api = null\n        }\n    }\n\n    disconnect(){\n        //TODO\n        //this.ws.disconnect()\n\n    }\n\n\n    render(){\n        return(\n            <div>\n                <List positions={this.state.positions} api={this.api}/>\n                <Control key_id={this.state.key_id} secret_key={this.state.secret_key} ticker={this.state.ticker} stream={this.state.stream} p1={this.state.p1} p2={this.state.p2} idChange={this.idChange} skChange={this.skChange} tickerChange={this.tickerChange} streamChange={this.streamChange} p1Change={this.p1Change} p2Change={this.p2Change} pairSwap={this.pairSwap} connect={this.connect}/>\n            </div>\n        )\n    }\n}\n\nexport default Main;"]},"metadata":{},"sourceType":"module"}