{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/home/ruitai/alpaca/frontend/src/Components/strats/bump.js\";\nimport { Component } from \"react\";\nimport PriceBtn from '../priceButton';\nimport PCTBar from '../pctBar'; //Automatically place limit sell at buy price + delta\n//Asset defined by user within parent class\n//User defines delta\n//User defines initial capital allocation\n//Operation Loop:\n//Not in a position\n//User places buy at a certain price (using price hover button)\n//Use all available capital to purchase at that price\n//Shares = capital / price\n//Have traditional key-in and submit alternative (Optional)\n//Waiting for buy order to fill (should be +/- instant?)\n//Scroll adjust order price after initial submission (Optional)\n//Alpaca trade status confirms trade\n//Place limit order to liquidate\n//limit price = buy price + delta\n//Waiting for sale to complete\n//Alpaca trade status confirms sale\n//Not in a position\n//Considerations:\n//Track session percent gains\n//Changing capital allocation should reset session gain tracking\n//Changing ticker symbol also resets it\n//Only allow changing capital allocation / symbol while not in a position\n//Changing the delta while still in a position should cancel the existing sell order and place a new one\n//If delta is set to zero then \n//Price hover button should act as limit sell when in a position\n//Secondary exit button without hover, places limit sell at price at time of click\n//Panic button places market sell order\n//Similar inverse strategy should exist - sell as it's dipping, re-buy a larger amount of shares at a lower price\n\nclass BumpStrat extends Component {\n  constructor(props) {\n    super(props); //Values that get passed to the component\n    //api - alpaca trade api\n    //ticker - symbol that we're trading on\n    //value - current price of the asset\n    //positions\n    //Functions that need to get bound to this instance\n\n    this.deltaChange = this.deltaChange.bind(this);\n    this.capChange = this.capChange.bind(this);\n    this.autoSellChange = this.autoSellChange.bind(this);\n    this.click = this.click.bind(this);\n    this.apiConfirm = this.apiConfirm.bind(this);\n    this.logOrders = this.logOrders.bind(this);\n    this.test = this.test.bind(this);\n    this.openOrders = {};\n    let startCapital;\n\n    if (this.props.positions.qty !== 0) {\n      startCapital = 0;\n    } else {\n      startCapital = 10000;\n    }\n\n    this.state = {\n      //This assumes we start out *not* in a position\n      //It will fuck up & double count if we already are in a position\n      capital: startCapital,\n      shares: this.props.positions.qty,\n      autoSell: true,\n      fracShares: false,\n      limit: null,\n      delta: 0.01,\n      openOrders: {},\n      status: \"out\" //out, in, waiting-entry, waiting-exit\n\n    };\n  }\n\n  test() {\n    console.log(this.props.positions);\n  }\n\n  deltaChange(e) {\n    this.setState({\n      delta: e.target.value\n    });\n    console.log(`New Delta: ${this.state.delta}`);\n  }\n\n  capChange(e) {\n    this.setState({\n      capital: e.target.value\n    });\n    console.log(`New Starting Allocation: ${this.state.capital}`); //Reset the statistics too\n  }\n\n  autoSellChange(e) {\n    this.setState({\n      autoSell: e.target.checked\n    });\n    console.log(`AutoSell set to ${e.target.checked}`);\n  } //This is kind of shitty because it will do it even when it's just the price data changing\n  //Ideally you want to call a function in bump from the parent component\n\n\n  componentDidUpdate(prevProps) {\n    //Not sure why, but this seems to only fire when an order is filled, partially filled, or cancelled\n    //Eg. When an order is closed\n    if (prevProps.positions !== this.props.positions) {\n      //console.log(\"bump/componentDidUpdate: Orders changed\")\n      //console.log(`bump/componentDidUpdate: Positions changed from ${JSON.stringify(prevProps.positions)} to ${JSON.stringify(this.props.positions)}`)\n      if (prevProps.positions.qty === 0 && this.props.positions.qty !== 0) {\n        console.log(`bump/componentDidUpdate: Bought ${this.props.positions.qty} shares at ${this.props.positions.entry_price} per share`);\n        this.setState({\n          capital: this.state.capital - this.props.positions.qty * this.props.positions.entry_price\n        });\n        this.setState({\n          shares: this.props.positions.qty\n        }); //Place Sell Order Immediately If AutoSell enabled:\n\n        if (this.state.autoSell) {\n          let symbol = this.props.ticker;\n          let qty = this.props.positions.qty;\n          let type = \"limit\";\n          let price = this.props.positions.entry_price + this.state.delta;\n          let time_in_force = \"day\";\n          console.log(`bump/componentDidUpdate: Placing AutoSell Order for ${qty} shares of ${symbol} at $${price} per share`);\n          this.props.api.sell(msg => this.apiConfirm(msg), symbol, qty, type, price, time_in_force);\n        }\n      } else if (prevProps.positions.qty !== 0 && this.props.positions.qty === 0) {\n        console.log(`bump/componentDidUpdate: Sold ${prevProps.positions.qty} shares at ${this.props.positions.exit_price} per share`);\n        this.setState({\n          capital: this.state.capital + prevProps.positions.qty * this.props.positions.exit_price\n        });\n        this.setState({\n          shares: 0\n        });\n      }\n\n      for (let id of Object.keys(this.openOrders)) {\n        if (this.props.positions.orders.id == null) {\n          console.log(`bump/componentDidUpdate: Removing order ${id} from openOrders`);\n          delete this.openOrders[id];\n        }\n      }\n\n      this.setState({\n        openOrders: this.openOrders\n      });\n    } //Check if any orders went from open to closed\n\n  }\n\n  logOrders() {\n    console.log(`bump/logOrders: ${JSON.stringify(this.state.openOrders)}`);\n\n    if (this.state.openOrders == null) {\n      console.log(`bump/logOrders: No open orders for ${this.props.ticker}`);\n    } else if (Object.keys(this.state.openOrders).length !== 0) {\n      console.log(`bump/logOrders: Currently Open Orders for ${this.props.ticker}: ${JSON.stringify(this.state.openOrders)}`);\n    }\n  }\n\n  apiConfirm(msg) {\n    //API buy callback; stores the confirmation info\n    //TODO: make sure it works for cancellations too\n    //When cancelling, I think it gives an empty array if there are no orders to cancel\n    //AFAIK, if it returns an empty message it means nothing happened, so whatever you tried to do didn't work\n    //In these scenarios it returns false and exist\n    //Otherwise it updates the openorders, \n    if (msg === \"\" || msg === \"[]\") {\n      console.log(\"bump/apiConfirm: No message\");\n      return false;\n    } else {\n      console.log(`bump/apiConfirm: Alpaca API Callback: ${msg}`);\n      let data = JSON.parse(msg);\n\n      if (!Array.isArray(data)) {\n        data = [data];\n      }\n\n      for (let datum of data) {\n        //Cancel response nests the info within the body, so we need to extract\n        if (datum.body != null) {\n          this.openOrders[datum.id] = {\n            [datum.body.side]: datum.body.qty,\n            price: datum.body.limit_price,\n            status: datum.body.status\n          };\n          console.log(`bump/apiConfirm: Order ${datum.id} : ${datum.body.side} ${datum.body.qty} shares of ${datum.body.symbol} for ${datum.body.limit_price}. Status: ${datum.body.status}`);\n        } else {\n          this.openOrders[datum.id] = {\n            [datum.side]: datum.qty,\n            price: datum.limit_price,\n            status: datum.status\n          };\n          console.log(`bump/apiConfirm: Order ${datum.id} : ${datum.side} ${datum.qty} shares of ${datum.symbol} for ${datum.limit_price}. Status: ${datum.status}`);\n        }\n\n        this.setState({\n          openOrders: this.openOrders\n        });\n      } //this.logOrders()\n\n\n      return true;\n    }\n  }\n\n  click(price) {\n    //if waiting to complete an order, then clicking will cancel it\n    //if not in a position, then it will place a buy\n    //if in a position, then it will place a sell\n    if (Object.keys(this.state.openOrders).length !== 0) {\n      for (let id of Object.keys(this.state.openOrders)) {\n        console.log(`bump/click: Cancelling order: ${id}`);\n        this.props.api.cancelOrder(id, this.apiConfirm);\n      }\n\n      console.log(`bump/click: Open Orders: ${JSON.stringify(this.state.openOrders)}`); //Rather than cancel, you could instead update the order to use the most recent price\n      //We already have a seperate cancel button\n    } else {\n      if (this.props.positions.qty === 0) {\n        //Place a limit buy order\n        //On completion, place limit sell @ delta\n        let symbol = this.props.ticker;\n        let qty = Math.floor(this.state.capital / price);\n        let type = \"limit\";\n        let time_in_force = \"day\";\n\n        if (qty === 0) {\n          alert(\"Not Enough Capital to Purchase any Shares\");\n        } else {\n          this.props.api.buy(msg => this.apiConfirm(msg), symbol, qty, type, price, time_in_force);\n        }\n      } else {\n        //place a limit sell\n        let symbol = this.props.ticker;\n        let qty = this.props.positions.qty;\n        let type = \"limit\";\n        let time_in_force = \"day\";\n        this.props.api.sell(msg => this.apiConfirm(msg), symbol, qty, type, price, time_in_force);\n      }\n    }\n    /*\n    if (this.state.status === \"out\"){\n        //Place a limit buy order\n        //On completion, place limit sell @ delta\n        let symbol = this.props.ticker\n        let qty = Math.floor(this.state.capital / price)\n        let type = \"limit\"\n        let time_in_force = \"gtc\"\n        this.props.api.buy((msg)=>this.apiConfirm(msg), symbol, qty, type, price, time_in_force)\n        \n    }else if (this.state.status === \"in\"){\n        //Place limit sell\n     }else if (this.state.status === \"waiting-entry\"){\n        //Cancel existing buy order\n     }else if (this.state.status === \"waiting-exit\"){\n        //Cancel sell order\n        //\n    }*/\n\n  }\n\n  render() {\n    let buttonText;\n    let btnValue; //Mar 5: This text won't reset after exiting positions\n\n    if (Object.keys(this.state.openOrders).length === 0) {\n      btnValue = this.props.value;\n\n      if (this.props.positions.qty === 0) {\n        buttonText = \"Enter\";\n      } else {\n        buttonText = \"Exit\";\n      }\n    } else {\n      buttonText = \"Cancel\"; //Assumes we will only have one order in openOrders\n\n      btnValue = this.openOrders[Object.keys(this.openOrders)[0]].price;\n    }\n\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [\"Bump Strat\", /*#__PURE__*/_jsxDEV(\"fieldset\", {\n        className: \"inputBox\",\n        children: [/*#__PURE__*/_jsxDEV(\"legend\", {\n          children: `Current Price: $${this.props.value}`\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 294,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(PCTBar, {\n          pctChange: \"0.1\",\n          width: \"500\",\n          height: \"50\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 295,\n          columnNumber: 21\n        }, this), \"Cash on Hand: $\", this.state.capital, /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 298,\n          columnNumber: 21\n        }, this), \"Shares: \", this.props.positions.qty, /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            htmlFor: \"slider\",\n            children: \"Capital Allocation\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 302,\n            columnNumber: 25\n          }, this), Object.keys(this.state.openOrders).length === 0 && this.props.positions.qty === 0 ? /*#__PURE__*/_jsxDEV(\"input\", {\n            style: {\n              float: \"right\",\n              width: \"150px\",\n              textAlign: \"center\"\n            },\n            value: this.state.capital,\n            onChange: this.capChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 305,\n            columnNumber: 29\n          }, this) : /*#__PURE__*/_jsxDEV(\"input\", {\n            disabled: true,\n            style: {\n              float: \"right\",\n              width: \"150px\",\n              textAlign: \"center\"\n            },\n            value: this.state.capital,\n            onChange: this.capChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 307,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 301,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Auto Sell:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 312,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            style: {\n              float: \"right\",\n              width: \"150px\",\n              textAlign: \"center\"\n            },\n            name: \"autoSell\",\n            type: \"checkbox\",\n            checked: this.state.autoSell,\n            onChange: this.autoSellChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 313,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 311,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            htmlFor: \"slider\",\n            children: [\"Delta: $\", this.state.delta]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 317,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            style: {\n              float: \"right\",\n              width: \"150px\",\n              textAlign: \"center\"\n            },\n            type: \"range\",\n            min: \"0\",\n            max: \"10\",\n            step: 0.01,\n            value: this.state.delta,\n            className: \"slider\",\n            id: \"slider\",\n            onChange: this.deltaChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 318,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            style: {\n              float: \"right\",\n              width: \"150px\",\n              textAlign: \"center\"\n            },\n            value: this.state.delta,\n            onChange: this.deltaChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 319,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 316,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            htmlFor: \"textbox\",\n            children: \"Manual Entry\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 323,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            style: {\n              float: \"right\",\n              width: \"150px\",\n              textAlign: \"center\"\n            },\n            value: this.state.delta,\n            onChange: this.deltaChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 324,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 322,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(PriceBtn, {\n          text: buttonText,\n          click: this.click,\n          value: btnValue\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 327,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: this.logOrders,\n          children: \"Log Open Orders\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 328,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: this.test,\n          children: \"Test Function\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 329,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => this.props.api.cancel(msg => this.apiConfirm(msg)),\n          children: \"Cancel All\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 330,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 293,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"fieldset\", {\n        className: \"inputBox\",\n        children: /*#__PURE__*/_jsxDEV(\"legend\", {\n          children: \"Manual Control\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 334,\n          columnNumber: 17\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 333,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 291,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default BumpStrat;","map":{"version":3,"sources":["/home/ruitai/alpaca/frontend/src/Components/strats/bump.js"],"names":["Component","PriceBtn","PCTBar","BumpStrat","constructor","props","deltaChange","bind","capChange","autoSellChange","click","apiConfirm","logOrders","test","openOrders","startCapital","positions","qty","state","capital","shares","autoSell","fracShares","limit","delta","status","console","log","e","setState","target","value","checked","componentDidUpdate","prevProps","entry_price","symbol","ticker","type","price","time_in_force","api","sell","msg","exit_price","id","Object","keys","orders","JSON","stringify","length","data","parse","Array","isArray","datum","body","side","limit_price","cancelOrder","Math","floor","alert","buy","render","buttonText","btnValue","float","width","textAlign","cancel"],"mappings":"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","sourcesContent":["import {Component} from \"react\";\nimport PriceBtn from '../priceButton';\nimport PCTBar from '../pctBar';\n\n//Automatically place limit sell at buy price + delta\n\n//Asset defined by user within parent class\n//User defines delta\n//User defines initial capital allocation\n\n//Operation Loop:\n//Not in a position\n//User places buy at a certain price (using price hover button)\n    //Use all available capital to purchase at that price\n    //Shares = capital / price\n    //Have traditional key-in and submit alternative (Optional)\n//Waiting for buy order to fill (should be +/- instant?)\n    //Scroll adjust order price after initial submission (Optional)\n//Alpaca trade status confirms trade\n    //Place limit order to liquidate\n    //limit price = buy price + delta\n//Waiting for sale to complete\n//Alpaca trade status confirms sale\n//Not in a position\n\n//Considerations:\n//Track session percent gains\n    //Changing capital allocation should reset session gain tracking\n    //Changing ticker symbol also resets it\n//Only allow changing capital allocation / symbol while not in a position\n//Changing the delta while still in a position should cancel the existing sell order and place a new one\n//If delta is set to zero then \n//Price hover button should act as limit sell when in a position\n//Secondary exit button without hover, places limit sell at price at time of click\n//Panic button places market sell order\n\n//Similar inverse strategy should exist - sell as it's dipping, re-buy a larger amount of shares at a lower price\n\n\n\nclass BumpStrat extends Component{\n    constructor(props){\n        super(props);\n        //Values that get passed to the component\n        //api - alpaca trade api\n        //ticker - symbol that we're trading on\n        //value - current price of the asset\n\n        //positions\n        \n\n        //Functions that need to get bound to this instance\n        this.deltaChange = this.deltaChange.bind(this);\n        this.capChange = this.capChange.bind(this);\n        this.autoSellChange = this.autoSellChange.bind(this);\n\n\n        this.click = this.click.bind(this);\n        this.apiConfirm = this.apiConfirm.bind(this);\n        this.logOrders = this.logOrders.bind(this);\n\n        this.test = this.test.bind(this);\n\n        this.openOrders = {}\n\n        let startCapital\n        if(this.props.positions.qty !== 0){\n            startCapital = 0\n        }else{\n            startCapital = 10000\n        }\n\n        this.state = {\n            //This assumes we start out *not* in a position\n            //It will fuck up & double count if we already are in a position\n            capital: startCapital,\n            shares: this.props.positions.qty,\n\n            autoSell: true,\n            fracShares: false,\n            limit: null,\n            delta: 0.01,\n\n            openOrders: {},\n            status: \"out\", //out, in, waiting-entry, waiting-exit\n\n            \n        }\n    }\n\n    test(){\n        console.log(this.props.positions)\n    }\n\n    deltaChange(e){\n        this.setState({delta: e.target.value})\n        console.log(`New Delta: ${this.state.delta}`)\n    }\n\n    capChange(e){\n        this.setState({capital: e.target.value})\n        console.log(`New Starting Allocation: ${this.state.capital}`)\n        //Reset the statistics too\n    }\n\n    autoSellChange(e){\n        this.setState({autoSell: e.target.checked})\n        console.log(`AutoSell set to ${e.target.checked}`)\n    }\n\n    //This is kind of shitty because it will do it even when it's just the price data changing\n    //Ideally you want to call a function in bump from the parent component\n    componentDidUpdate(prevProps){\n\n        //Not sure why, but this seems to only fire when an order is filled, partially filled, or cancelled\n        //Eg. When an order is closed\n        if (prevProps.positions !== this.props.positions){\n            //console.log(\"bump/componentDidUpdate: Orders changed\")\n            //console.log(`bump/componentDidUpdate: Positions changed from ${JSON.stringify(prevProps.positions)} to ${JSON.stringify(this.props.positions)}`)\n\n            \n            if(prevProps.positions.qty === 0 && this.props.positions.qty !== 0){\n                console.log(`bump/componentDidUpdate: Bought ${this.props.positions.qty} shares at ${this.props.positions.entry_price} per share`)\n                this.setState({capital: this.state.capital - (this.props.positions.qty * this.props.positions.entry_price)})\n                this.setState({shares: this.props.positions.qty})\n\n                //Place Sell Order Immediately If AutoSell enabled:\n                if (this.state.autoSell){\n                    let symbol = this.props.ticker\n                    let qty = this.props.positions.qty\n                    let type = \"limit\"\n                    let price = this.props.positions.entry_price + this.state.delta\n                    let time_in_force = \"day\"\n                    console.log(`bump/componentDidUpdate: Placing AutoSell Order for ${qty} shares of ${symbol} at $${price} per share`)\n                    this.props.api.sell((msg)=>this.apiConfirm(msg), symbol, qty, type, price, time_in_force)\n                }\n\n            }else if (prevProps.positions.qty !== 0 && this.props.positions.qty === 0){\n                console.log(`bump/componentDidUpdate: Sold ${prevProps.positions.qty} shares at ${this.props.positions.exit_price} per share`)\n                this.setState({capital: this.state.capital + (prevProps.positions.qty * this.props.positions.exit_price)})\n                this.setState({shares: 0})\n            }\n\n\n            for (let id of Object.keys(this.openOrders)){\n                if (this.props.positions.orders.id == null){\n                    console.log(`bump/componentDidUpdate: Removing order ${id} from openOrders`)\n                    delete this.openOrders[id]\n                }\n            }\n            this.setState({openOrders: this.openOrders})\n        }\n\n        //Check if any orders went from open to closed\n    }\n\n    logOrders(){\n\n        console.log(`bump/logOrders: ${JSON.stringify(this.state.openOrders)}`)\n        if (this.state.openOrders == null){\n            console.log(`bump/logOrders: No open orders for ${this.props.ticker}`)\n        }\n        else if (Object.keys(this.state.openOrders).length !== 0){\n            console.log(`bump/logOrders: Currently Open Orders for ${this.props.ticker}: ${JSON.stringify(this.state.openOrders)}`)\n        }\n    }\n\n    apiConfirm(msg){\n        //API buy callback; stores the confirmation info\n        //TODO: make sure it works for cancellations too\n\n        //When cancelling, I think it gives an empty array if there are no orders to cancel\n\n        //AFAIK, if it returns an empty message it means nothing happened, so whatever you tried to do didn't work\n        //In these scenarios it returns false and exist\n        //Otherwise it updates the openorders, \n\n        if (msg === \"\" || msg === \"[]\"){\n            console.log(\"bump/apiConfirm: No message\")\n            return false\n        }else{\n\n            console.log(`bump/apiConfirm: Alpaca API Callback: ${msg}`)\n            let data = JSON.parse(msg)\n            if (!Array.isArray(data)){\n                data = [data]\n            }\n\n            for (let datum of data){\n                //Cancel response nests the info within the body, so we need to extract\n                if(datum.body != null){\n                    this.openOrders[datum.id]= {[datum.body.side]: datum.body.qty, price: datum.body.limit_price, status: datum.body.status}\n                    console.log(`bump/apiConfirm: Order ${datum.id} : ${datum.body.side} ${datum.body.qty} shares of ${datum.body.symbol} for ${datum.body.limit_price}. Status: ${datum.body.status}`)                    \n                }else{\n                    this.openOrders[datum.id]= {[datum.side]: datum.qty, price: datum.limit_price, status: datum.status}\n                    console.log(`bump/apiConfirm: Order ${datum.id} : ${datum.side} ${datum.qty} shares of ${datum.symbol} for ${datum.limit_price}. Status: ${datum.status}`)\n                }\n                this.setState({openOrders: this.openOrders})\n            }\n\n            //this.logOrders()\n\n            return true\n        }\n    }\n\n    click(price){\n\n        //if waiting to complete an order, then clicking will cancel it\n        //if not in a position, then it will place a buy\n        //if in a position, then it will place a sell\n\n        if (Object.keys(this.state.openOrders).length !== 0){\n            for (let id of Object.keys(this.state.openOrders)){\n                console.log(`bump/click: Cancelling order: ${id}`)\n                this.props.api.cancelOrder(id, this.apiConfirm)\n            }\n\n            console.log(`bump/click: Open Orders: ${JSON.stringify(this.state.openOrders)}`)\n\n            //Rather than cancel, you could instead update the order to use the most recent price\n            //We already have a seperate cancel button\n        }else{\n            if (this.props.positions.qty === 0){\n                //Place a limit buy order\n                //On completion, place limit sell @ delta\n                let symbol = this.props.ticker\n                let qty = Math.floor(this.state.capital / price)\n                let type = \"limit\"\n                let time_in_force = \"day\"\n                if(qty === 0){\n                    alert(\"Not Enough Capital to Purchase any Shares\")\n                }else{\n                    this.props.api.buy((msg)=>this.apiConfirm(msg), symbol, qty, type, price, time_in_force)\n                }\n                \n            }else{\n                //place a limit sell\n                let symbol = this.props.ticker\n                let qty = this.props.positions.qty\n                let type = \"limit\"\n                let time_in_force = \"day\"\n                this.props.api.sell((msg)=>this.apiConfirm(msg), symbol, qty, type, price, time_in_force)\n            }    \n        }\n\n        /*\n        if (this.state.status === \"out\"){\n            //Place a limit buy order\n            //On completion, place limit sell @ delta\n            let symbol = this.props.ticker\n            let qty = Math.floor(this.state.capital / price)\n            let type = \"limit\"\n            let time_in_force = \"gtc\"\n            this.props.api.buy((msg)=>this.apiConfirm(msg), symbol, qty, type, price, time_in_force)\n            \n        }else if (this.state.status === \"in\"){\n            //Place limit sell\n\n        }else if (this.state.status === \"waiting-entry\"){\n            //Cancel existing buy order\n\n        }else if (this.state.status === \"waiting-exit\"){\n            //Cancel sell order\n            //\n        }*/\n    }\n\n    render(){\n        let buttonText\n        let btnValue\n        \n        //Mar 5: This text won't reset after exiting positions\n        if (Object.keys(this.state.openOrders).length === 0){\n            btnValue = this.props.value \n            if(this.props.positions.qty === 0){\n                buttonText = \"Enter\"   \n            }else{\n                buttonText = \"Exit\"\n            }\n            \n        }else{\n            buttonText = \"Cancel\"\n\n            //Assumes we will only have one order in openOrders\n            btnValue = this.openOrders[Object.keys(this.openOrders)[0]].price\n            \n        }\n\n        return(\n            <div>\n                Bump Strat\n                <fieldset className=\"inputBox\">\n                    <legend>{`Current Price: $${this.props.value}`}</legend>\n                    <PCTBar pctChange=\"0.1\" width=\"500\" height=\"50\"/>\n\n                    Cash on Hand: ${this.state.capital}\n                    <br></br>\n                    Shares: {this.props.positions.qty}\n\n                    <div>\n                        <label htmlFor=\"slider\">Capital Allocation</label>\n                        {/*Only enable if no pending orders and no shares held */}\n                        {(Object.keys(this.state.openOrders).length === 0 && this.props.positions.qty === 0) ? \n                            <input style={{float:\"right\", width:\"150px\", textAlign:\"center\"}} value={this.state.capital} onChange={this.capChange}/>\n                            :\n                            <input disabled style={{float:\"right\", width:\"150px\", textAlign:\"center\"}} value={this.state.capital} onChange={this.capChange}/>\n                        }\n                    </div>\n\n                    <div>\n                    <label>Auto Sell:</label>\n                        <input style={{float:\"right\", width:\"150px\", textAlign:\"center\"}} name=\"autoSell\" type=\"checkbox\" checked={this.state.autoSell} onChange={this.autoSellChange} />\n                    </div>\n\n                    <div>\n                        <label htmlFor=\"slider\">Delta: ${this.state.delta}</label>\n                        <input style={{float:\"right\", width:\"150px\", textAlign:\"center\"}} type=\"range\" min=\"0\" max=\"10\" step={0.01} value={this.state.delta} className=\"slider\" id=\"slider\" onChange={this.deltaChange}/>\n                        <input style={{float:\"right\", width:\"150px\", textAlign:\"center\"}} value={this.state.delta} onChange={this.deltaChange}/>\n                    </div>\n\n                    <div>\n                        <label htmlFor=\"textbox\">Manual Entry</label>\n                        <input style={{float:\"right\", width:\"150px\", textAlign:\"center\"}} value={this.state.delta} onChange={this.deltaChange}/>\n                    </div>\n\n                    <PriceBtn text={buttonText} click={this.click} value={btnValue}/>\n                    <button onClick={this.logOrders}>Log Open Orders</button>\n                    <button onClick={this.test}>Test Function</button>\n                    <button onClick={()=>this.props.api.cancel((msg)=>this.apiConfirm(msg))}>Cancel All</button>                    \n                </fieldset>\n\n                <fieldset className=\"inputBox\">\n                <legend>Manual Control</legend>\n\n\n                </fieldset>\n            </div>\n        )\n        \n    }\n}\n\nexport default BumpStrat;"]},"metadata":{},"sourceType":"module"}