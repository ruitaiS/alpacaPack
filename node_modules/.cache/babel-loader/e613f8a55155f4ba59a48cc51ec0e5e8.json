{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/home/ruitai/alpaca/frontend/src/Components/strats/bump.js\";\nimport { Component } from \"react\";\nimport PriceBtn from '../priceButton';\nimport PCTBar from '../pctBar'; //Automatically place limit sell at buy price + delta\n//Asset defined by user within parent class\n//User defines delta\n//User defines initial capital allocation\n//Operation Loop:\n//Not in a position\n//User places buy at a certain price (using price hover button)\n//Use all available capital to purchase at that price\n//Shares = capital / price\n//Have traditional key-in and submit alternative (Optional)\n//Waiting for buy order to fill (should be +/- instant?)\n//Scroll adjust order price after initial submission (Optional)\n//Alpaca trade status confirms trade\n//Place limit order to liquidate\n//limit price = buy price + delta\n//Waiting for sale to complete\n//Alpaca trade status confirms sale\n//Not in a position\n//Considerations:\n//Track session percent gains\n//Changing capital allocation should reset session gain tracking\n//Changing ticker symbol also resets it\n//Only allow changing capital allocation / symbol while not in a position\n//Changing the delta while still in a position should cancel the existing sell order and place a new one\n//If delta is set to zero then \n//Price hover button should act as limit sell when in a position\n//Secondary exit button without hover, places limit sell at price at time of click\n//Panic button places market sell order\n//Similar inverse strategy should exist - sell as it's dipping, re-buy a larger amount of shares at a lower price\n\nclass BumpStrat extends Component {\n  constructor(props) {\n    super(props); //Values that get passed to the component\n    //api - alpaca trade api\n    //ticker - symbol that we're trading on\n    //value - current price of the asset\n    //positions\n    //Functions that need to get bound to this instance\n\n    this.deltaChange = this.deltaChange.bind(this);\n    this.click = this.click.bind(this);\n    this.apiConfirm = this.apiConfirm.bind(this);\n    this.logOrders = this.logOrders.bind(this);\n    this.test = this.test.bind(this);\n    this.openOrders = {};\n    this.state = {\n      capital: 10000,\n      delta: 0.01,\n      openOrders: null,\n      status: \"out\" //out, in, waiting-entry, waiting-exit\n\n    };\n  }\n\n  test() {\n    console.log(this.props.positions);\n  }\n\n  deltaChange(e) {\n    this.setState({\n      delta: e.target.value\n    });\n    console.log(`New Delta: ${this.state.delta}`);\n  }\n\n  capChange(e) {\n    this.setState({\n      capital: e.target.value\n    });\n    console.log(`New Starting Allocation: ${this.state.capital}`); //Reset the statistics too\n  } //This is kind of shitty because it will do it even when it's just the price data changing\n  //Ideally you want to call a function in bump from the parent component\n\n\n  componentDidUpdate(prevProps) {\n    //Not sure why, but this seems to only fire when an order is filled, partially filled, or cancelled\n    //Eg. When an order is closed\n    if (prevProps.positions !== this.props.positions) {\n      console.log(\"bump/componentDidUpdate: Orders changed\");\n      console.log(`bump/componentDidUpdate: Positions changed from ${JSON.stringify(prevProps.positions)} to ${JSON.stringify(this.props.positions)}`);\n\n      for (let id of Object.keys(this.openOrders)) {\n        if (this.props.positions.orders.id == null) {\n          console.log(`bump/componentDidUpdate: Removing order ${id} from openOrders`);\n          delete this.openOrders[id];\n        }\n      }\n\n      this.setState({\n        openOrders: this.openOrders\n      });\n    } //Check if any orders went from open to closed\n\n  }\n\n  logOrders() {\n    console.log(`bump/logOrders: ${JSON.stringify(this.state.openOrders)}`);\n\n    if (this.state.openOrders == null) {\n      console.log(`bump/logOrders: No open orders for ${this.props.ticker}`);\n    } else if (Object.keys(this.state.openOrders).length !== 0) {\n      console.log(`bump/logOrders: Currently Open Orders for ${this.props.ticker}: ${JSON.stringify(this.state.openOrders)}`);\n    }\n  }\n\n  apiConfirm(msg) {\n    //API buy callback; stores the confirmation info\n    //TODO: make sure it works for cancellations too\n    //When cancelling, I think it gives an empty array if there are no orders to cancel\n    //AFAIK, if it returns an empty message it means nothing happened, so whatever you tried to do didn't work\n    //In these scenarios it returns false and exist\n    //Otherwise it updates the openorders, \n    if (msg === \"\" || msg === \"[]\") {\n      console.log(\"bump/apiConfirm: No message\");\n      return false;\n    } else {\n      console.log(`bump/apiConfirm: Alpaca API Callback: ${msg}`);\n      let data = JSON.parse(msg);\n\n      if (!Array.isArray(data)) {\n        data = [data];\n      }\n\n      for (let datum of data) {\n        //Cancel response nests the info within the body, so we need to extract\n        if (datum.body != null) {\n          this.openOrders[datum.id] = {\n            [datum.body.side]: datum.body.qty,\n            price: datum.body.limit_price,\n            status: datum.body.status\n          };\n          console.log(`bump/apiConfirm: Order ${datum.id} : ${datum.body.side} ${datum.body.qty} shares of ${datum.body.symbol} for ${datum.body.limit_price}. Status: ${datum.body.status}`);\n        } else {\n          this.openOrders[datum.id] = {\n            [datum.side]: datum.qty,\n            price: datum.limit_price,\n            status: datum.status\n          };\n          console.log(`bump/apiConfirm: Order ${datum.id} : ${datum.side} ${datum.qty} shares of ${datum.symbol} for ${datum.limit_price}. Status: ${datum.status}`);\n        }\n\n        this.setState({\n          openOrders: this.openOrders\n        });\n      } //this.logOrders()\n\n\n      return true;\n    }\n  }\n\n  click(price) {\n    //if waiting to complete an order, then clicking will cancel it\n    //if not in a position, then it will place a buy\n    //if in a position, then it will place a sell\n    if (this.state.openOrders != null) {\n      //TODO: Cancel by order ID, rather than cancel all\n      //this.props.api.cancel((msg)=>this.apiConfirm(msg))\n      //Not sure why this version doesn't iterate,\n      //since it's the same one used elsewhere to iterate keys...\n      //for (let id of this.state.openOrders){\n      for (let id of Object.keys(this.state.openOrders)) {\n        console.log(`bump/click: Cancelling order: ${id}`);\n        this.props.api.cancelOrder(id, this.apiConfirm);\n      }\n\n      console.log(`bump/click: Open Orders: ${JSON.stringify(this.state.openOrders)}`); //Rather than cancel, you could instead update the order to use the most recent price\n      //We already have a seperate cancel button\n    } else {\n      //TODO: Check position size, rather than depend on state\n      if (this.state.status === \"out\") {\n        //Place a limit buy order\n        //On completion, place limit sell @ delta\n        let symbol = this.props.ticker;\n        let qty = Math.floor(this.state.capital / price);\n        let type = \"limit\";\n        let time_in_force = \"gtc\";\n        this.props.api.buy(msg => this.apiConfirm(msg), symbol, qty, type, price, time_in_force);\n      } else {\n        //place a limit sell\n        console.log(`bump/click: pretend we're selling at ${price}`);\n      }\n    }\n    /*\n    if (this.state.status === \"out\"){\n        //Place a limit buy order\n        //On completion, place limit sell @ delta\n        let symbol = this.props.ticker\n        let qty = Math.floor(this.state.capital / price)\n        let type = \"limit\"\n        let time_in_force = \"gtc\"\n        this.props.api.buy((msg)=>this.apiConfirm(msg), symbol, qty, type, price, time_in_force)\n        \n    }else if (this.state.status === \"in\"){\n        //Place limit sell\n     }else if (this.state.status === \"waiting-entry\"){\n        //Cancel existing buy order\n     }else if (this.state.status === \"waiting-exit\"){\n        //Cancel sell order\n        //\n    }*/\n\n  }\n\n  render() {\n    let buttonText;\n\n    if (this.state.openOrders !== null || Object.keys(this.state.openOrders).length !== 0) {\n      buttonText = \"Cancel\";\n    } else {\n      //Todo: format this\n      buttonText = \"Enter/Exit\";\n    }\n\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [\"Bump Strat\", /*#__PURE__*/_jsxDEV(\"fieldset\", {\n        className: \"inputBox\",\n        children: [/*#__PURE__*/_jsxDEV(\"legend\", {\n          children: `Current Price: $${this.props.value}`\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 233,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(PCTBar, {\n          pctChange: \"0.1\",\n          width: \"500\",\n          height: \"50\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 234,\n          columnNumber: 21\n        }, this), Object.keys(this.props.positions.orders).length === 0 ? \"No Open Orders\" : `Status: ${JSON.stringify(this.props.positions.orders)}`, /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            htmlFor: \"slider\",\n            children: [\"Capital Allocation: $\", this.state.capital]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 242,\n            columnNumber: 25\n          }, this), this.state.status === \"out\" ? /*#__PURE__*/_jsxDEV(\"input\", {\n            style: {\n              float: \"right\",\n              width: \"150px\",\n              textAlign: \"center\"\n            },\n            value: this.state.capital,\n            onChange: this.capChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 245,\n            columnNumber: 29\n          }, this) : /*#__PURE__*/_jsxDEV(\"input\", {\n            disabled: true,\n            style: {\n              float: \"right\",\n              width: \"150px\",\n              textAlign: \"center\"\n            },\n            value: this.state.capital,\n            onChange: this.capChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 247,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 241,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            htmlFor: \"slider\",\n            children: [\"Delta: $\", this.state.delta]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 252,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            style: {\n              float: \"right\",\n              width: \"150px\",\n              textAlign: \"center\"\n            },\n            type: \"range\",\n            min: \"0\",\n            max: \"10\",\n            step: 0.01,\n            value: this.state.delta,\n            className: \"slider\",\n            id: \"slider\",\n            onChange: this.deltaChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 253,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            style: {\n              float: \"right\",\n              width: \"150px\",\n              textAlign: \"center\"\n            },\n            value: this.state.delta,\n            onChange: this.deltaChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 254,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 251,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(PriceBtn, {\n          text: buttonText,\n          click: this.click,\n          value: this.props.value\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 257,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: this.logOrders,\n          children: \"Log Open Orders\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 258,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: this.test,\n          children: \"Test Function\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 259,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => this.props.api.cancel(msg => this.apiConfirm(msg)),\n          children: \"Cancel All\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 260,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 232,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 230,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default BumpStrat;","map":{"version":3,"sources":["/home/ruitai/alpaca/frontend/src/Components/strats/bump.js"],"names":["Component","PriceBtn","PCTBar","BumpStrat","constructor","props","deltaChange","bind","click","apiConfirm","logOrders","test","openOrders","state","capital","delta","status","console","log","positions","e","setState","target","value","capChange","componentDidUpdate","prevProps","JSON","stringify","id","Object","keys","orders","ticker","length","msg","data","parse","Array","isArray","datum","body","side","qty","price","limit_price","symbol","api","cancelOrder","Math","floor","type","time_in_force","buy","render","buttonText","float","width","textAlign","cancel"],"mappings":"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","sourcesContent":["import {Component} from \"react\";\nimport PriceBtn from '../priceButton';\nimport PCTBar from '../pctBar';\n\n//Automatically place limit sell at buy price + delta\n\n//Asset defined by user within parent class\n//User defines delta\n//User defines initial capital allocation\n\n//Operation Loop:\n//Not in a position\n//User places buy at a certain price (using price hover button)\n    //Use all available capital to purchase at that price\n    //Shares = capital / price\n    //Have traditional key-in and submit alternative (Optional)\n//Waiting for buy order to fill (should be +/- instant?)\n    //Scroll adjust order price after initial submission (Optional)\n//Alpaca trade status confirms trade\n    //Place limit order to liquidate\n    //limit price = buy price + delta\n//Waiting for sale to complete\n//Alpaca trade status confirms sale\n//Not in a position\n\n//Considerations:\n//Track session percent gains\n    //Changing capital allocation should reset session gain tracking\n    //Changing ticker symbol also resets it\n//Only allow changing capital allocation / symbol while not in a position\n//Changing the delta while still in a position should cancel the existing sell order and place a new one\n//If delta is set to zero then \n//Price hover button should act as limit sell when in a position\n//Secondary exit button without hover, places limit sell at price at time of click\n//Panic button places market sell order\n\n//Similar inverse strategy should exist - sell as it's dipping, re-buy a larger amount of shares at a lower price\n\n\n\nclass BumpStrat extends Component{\n    constructor(props){\n        super(props);\n        //Values that get passed to the component\n        //api - alpaca trade api\n        //ticker - symbol that we're trading on\n        //value - current price of the asset\n\n        //positions\n        \n\n        //Functions that need to get bound to this instance\n        this.deltaChange = this.deltaChange.bind(this);\n        this.click = this.click.bind(this);\n        this.apiConfirm = this.apiConfirm.bind(this);\n        this.logOrders = this.logOrders.bind(this);\n\n        this.test = this.test.bind(this);\n\n        this.openOrders = {}\n        this.state = {\n            capital: 10000,\n            delta: 0.01,\n\n            openOrders: null,\n            status: \"out\", //out, in, waiting-entry, waiting-exit\n\n            \n        }\n    }\n\n    test(){\n        console.log(this.props.positions)\n    }\n\n    deltaChange(e){\n        this.setState({delta: e.target.value})\n        console.log(`New Delta: ${this.state.delta}`)\n    }\n\n    capChange(e){\n        this.setState({capital: e.target.value})\n        console.log(`New Starting Allocation: ${this.state.capital}`)\n        //Reset the statistics too\n    }\n\n    //This is kind of shitty because it will do it even when it's just the price data changing\n    //Ideally you want to call a function in bump from the parent component\n    componentDidUpdate(prevProps){\n\n        //Not sure why, but this seems to only fire when an order is filled, partially filled, or cancelled\n        //Eg. When an order is closed\n        if (prevProps.positions !== this.props.positions){\n            console.log(\"bump/componentDidUpdate: Orders changed\")\n            console.log(`bump/componentDidUpdate: Positions changed from ${JSON.stringify(prevProps.positions)} to ${JSON.stringify(this.props.positions)}`)\n            for (let id of Object.keys(this.openOrders)){\n                if (this.props.positions.orders.id == null){\n                    console.log(`bump/componentDidUpdate: Removing order ${id} from openOrders`)\n                    delete this.openOrders[id]\n                }\n            }\n            this.setState({openOrders: this.openOrders})\n        }\n\n        //Check if any orders went from open to closed\n    }\n\n    logOrders(){\n        console.log(`bump/logOrders: ${JSON.stringify(this.state.openOrders)}`)\n        if (this.state.openOrders == null){\n            console.log(`bump/logOrders: No open orders for ${this.props.ticker}`)\n        }\n        else if (Object.keys(this.state.openOrders).length !== 0){\n            console.log(`bump/logOrders: Currently Open Orders for ${this.props.ticker}: ${JSON.stringify(this.state.openOrders)}`)\n        }\n    }\n\n    apiConfirm(msg){\n        //API buy callback; stores the confirmation info\n        //TODO: make sure it works for cancellations too\n\n        //When cancelling, I think it gives an empty array if there are no orders to cancel\n\n        //AFAIK, if it returns an empty message it means nothing happened, so whatever you tried to do didn't work\n        //In these scenarios it returns false and exist\n        //Otherwise it updates the openorders, \n\n        if (msg === \"\" || msg === \"[]\"){\n            console.log(\"bump/apiConfirm: No message\")\n            return false\n        }else{\n\n            console.log(`bump/apiConfirm: Alpaca API Callback: ${msg}`)\n            let data = JSON.parse(msg)\n            if (!Array.isArray(data)){\n                data = [data]\n            }\n\n            for (let datum of data){\n                //Cancel response nests the info within the body, so we need to extract\n                if(datum.body != null){\n                    this.openOrders[datum.id]= {[datum.body.side]: datum.body.qty, price: datum.body.limit_price, status: datum.body.status}\n                    console.log(`bump/apiConfirm: Order ${datum.id} : ${datum.body.side} ${datum.body.qty} shares of ${datum.body.symbol} for ${datum.body.limit_price}. Status: ${datum.body.status}`)                    \n                }else{\n                    this.openOrders[datum.id]= {[datum.side]: datum.qty, price: datum.limit_price, status: datum.status}\n                    console.log(`bump/apiConfirm: Order ${datum.id} : ${datum.side} ${datum.qty} shares of ${datum.symbol} for ${datum.limit_price}. Status: ${datum.status}`)\n                }\n                this.setState({openOrders: this.openOrders})\n            }\n\n            //this.logOrders()\n\n            return true\n        }\n    }\n\n    click(price){\n\n        //if waiting to complete an order, then clicking will cancel it\n        //if not in a position, then it will place a buy\n        //if in a position, then it will place a sell\n\n        if (this.state.openOrders != null){\n            //TODO: Cancel by order ID, rather than cancel all\n            //this.props.api.cancel((msg)=>this.apiConfirm(msg))\n\n            //Not sure why this version doesn't iterate,\n            //since it's the same one used elsewhere to iterate keys...\n            //for (let id of this.state.openOrders){\n\n            for (let id of Object.keys(this.state.openOrders)){\n                console.log(`bump/click: Cancelling order: ${id}`)\n                this.props.api.cancelOrder(id, this.apiConfirm)\n            }\n\n            console.log(`bump/click: Open Orders: ${JSON.stringify(this.state.openOrders)}`)\n\n            //Rather than cancel, you could instead update the order to use the most recent price\n            //We already have a seperate cancel button\n        }else{\n            //TODO: Check position size, rather than depend on state\n            if (this.state.status === \"out\"){\n                //Place a limit buy order\n                //On completion, place limit sell @ delta\n                let symbol = this.props.ticker\n                let qty = Math.floor(this.state.capital / price)\n                let type = \"limit\"\n                let time_in_force = \"gtc\"\n                this.props.api.buy((msg)=>this.apiConfirm(msg), symbol, qty, type, price, time_in_force)\n                \n            }else{\n                //place a limit sell\n                console.log(`bump/click: pretend we're selling at ${price}`)\n            }    \n        }\n\n        /*\n        if (this.state.status === \"out\"){\n            //Place a limit buy order\n            //On completion, place limit sell @ delta\n            let symbol = this.props.ticker\n            let qty = Math.floor(this.state.capital / price)\n            let type = \"limit\"\n            let time_in_force = \"gtc\"\n            this.props.api.buy((msg)=>this.apiConfirm(msg), symbol, qty, type, price, time_in_force)\n            \n        }else if (this.state.status === \"in\"){\n            //Place limit sell\n\n        }else if (this.state.status === \"waiting-entry\"){\n            //Cancel existing buy order\n\n        }else if (this.state.status === \"waiting-exit\"){\n            //Cancel sell order\n            //\n        }*/\n    }\n\n    render(){\n        let buttonText\n        \n        if (this.state.openOrders !== null || Object.keys(this.state.openOrders).length !== 0){\n            buttonText = \"Cancel\"\n        }else{\n            //Todo: format this\n            buttonText = \"Enter/Exit\"\n        }\n\n        return(\n            <div>\n                Bump Strat\n                <fieldset className=\"inputBox\">\n                    <legend>{`Current Price: $${this.props.value}`}</legend>\n                    <PCTBar pctChange=\"0.1\" width=\"500\" height=\"50\"/>\n\n                    {Object.keys(this.props.positions.orders).length === 0 ?\n                    \"No Open Orders\"\n                    :\n                    `Status: ${JSON.stringify(this.props.positions.orders)}`}\n\n                    <div>\n                        <label htmlFor=\"slider\">Capital Allocation: ${this.state.capital}</label>\n                        {/*Conditionally disable if we're in a position */}\n                        {this.state.status === \"out\" ? \n                            <input style={{float:\"right\", width:\"150px\", textAlign:\"center\"}} value={this.state.capital} onChange={this.capChange}/>\n                            :\n                            <input disabled style={{float:\"right\", width:\"150px\", textAlign:\"center\"}} value={this.state.capital} onChange={this.capChange}/>\n                        }\n                    </div>\n\n                    <div>\n                        <label htmlFor=\"slider\">Delta: ${this.state.delta}</label>\n                        <input style={{float:\"right\", width:\"150px\", textAlign:\"center\"}} type=\"range\" min=\"0\" max=\"10\" step={0.01} value={this.state.delta} className=\"slider\" id=\"slider\" onChange={this.deltaChange}/>\n                        <input style={{float:\"right\", width:\"150px\", textAlign:\"center\"}} value={this.state.delta} onChange={this.deltaChange}/>\n                    </div>\n\n                    <PriceBtn text={buttonText} click={this.click} value={this.props.value}/>\n                    <button onClick={this.logOrders}>Log Open Orders</button>\n                    <button onClick={this.test}>Test Function</button>\n                    <button onClick={()=>this.props.api.cancel((msg)=>this.apiConfirm(msg))}>Cancel All</button>\n                    \n                </fieldset>\n            </div>\n        )\n        \n    }\n}\n\nexport default BumpStrat;"]},"metadata":{},"sourceType":"module"}