{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/home/ruitai/alpaca/frontend/src/Components/main.js\";\nimport { Component } from \"react\";\nimport Control from './control';\nimport API from './apiHandler';\nimport Stream from \"./stream\";\nimport List from './list';\n\nclass Main extends Component {\n  constructor(props) {\n    super(props); //Values that get passed to the component\n\n    this.tickerChange = this.tickerChange.bind(this);\n    this.idChange = this.idChange.bind(this);\n    this.skChange = this.skChange.bind(this);\n    this.streamChange = this.streamChange.bind(this);\n    this.p1Change = this.p1Change.bind(this);\n    this.p2Change = this.p2Change.bind(this);\n    this.pairSwap = this.pairSwap.bind(this);\n    this.streamListener = this.streamListener.bind(this);\n    this.connect = this.connect.bind(this);\n    this.initPositions = this.initPositions.bind(this);\n    this.apiPositionListener = this.apiPositionListener.bind(this); //this.subscribe = this.subscribe.bind(this);\n    //this.unsubscribe = this.unsubscribe.bind(this);\n    //this.initPositions = this.initPositions.bind(this);\n    //this.get_price = this.get_price.bind(this);\n\n    this.state = {\n      key_id: 'PK5YYD0RTSIBEH5O4IG7',\n      //key_id: 'bvqgf2n48v6qg460kck0',\n      secret_key: 'vbrBfUR0BkmsjtR13sB0mxqYOPQqaR67ARJoZO4P',\n      //positions: array of [Ticker, qty, avg price] arrays,\n      stream: 'stocks',\n      //stream: 'forex',\n      ticker: 'MSFT',\n      // Ticker is the active window ticker symbol\n      p1: \"USD\",\n      p2: \"CAD\"\n    };\n  } //#region Onchange Functions (Called from Control Panel)\n  //TODO: May need to update the websocket stream & also the api handler\n  //NOTE: Using this.state.[whatever] after setState doesn't seem to update it until the next iteration;\n  //Need to directly use e.target.value\n\n\n  tickerChange(e) {\n    this.setState({\n      ticker: e.target.value\n    });\n  }\n\n  idChange(e) {\n    this.setState({\n      key_id: e.target.value\n    });\n  }\n\n  skChange(e) {\n    this.setState({\n      secret_key: e.target.value\n    });\n  }\n\n  streamChange(e) {\n    //TODO -> What should the behavior here be wrt to the currently active connections?\n    this.setState({\n      stream: e.target.value\n    }); //this.disconnect()\n    //url state is updated in connect()\n  } //Currency Pair Related Functions\n\n\n  p1Change(e) {\n    this.setState({\n      p1: e.target.value\n    });\n  }\n\n  p2Change(e) {\n    this.setState({\n      p2: e.target.value\n    });\n  }\n\n  pairSwap() {\n    let p1Now = this.state.p1;\n    let p2Now = this.state.p2;\n    this.setState({\n      p1: p2Now\n    });\n    this.setState({\n      p2: p1Now\n    });\n  } //#endregion\n\n\n  streamListener(msg) {\n    //websocket callback; parses incoming data and updates state\n    let data = JSON.parse(msg.data);\n\n    if (data[0].message != null) {\n      console.log(data[0].message); //initialize positions after authentication confirmation\n\n      if (data[0].message === 'authenticated') {\n        this.ws.subscribe(this.state.ticker);\n        this.initPositions();\n      }\n    } else {\n      //Message is null, so we assume it is already subscribed to a stream\n      //console.log(JSON.stringify(data))\n      this.setState({\n        streamData: data\n      });\n    }\n  }\n\n  apiPositionListener(msg) {\n    //Run only from initPositions\n    let positions = {}; // Symbol: [qty, price]\n\n    for (let position of JSON.parse(msg)) {\n      positions[position.symbol] = [position.qty, position.avg_entry_price];\n      this.ws.subscribe(position.symbol);\n    }\n\n    this.setState({\n      positions: positions\n    }); //console.log(this.state.positions)\n  }\n\n  initPositions() {\n    this.api.get_positions(this.apiPositionListener);\n  }\n\n  connect() {\n    //Creates new connections to API and Stream\n    if (this.state.stream === \"stocks\") {\n      this.ws = new Stream(this.state.key_id, 'wss://socket.polygon.io/stocks', this.streamListener);\n      this.api = new API(this.state.key_id, this.state.secret_key, 'https://paper-api.alpaca.markets');\n      this.initPositions();\n    } else {\n      alert(\"Forex support coming soon!\");\n      this.setState({\n        stream: \"stocks\"\n      }); //this.ws = new Stream(this.state.key_id, `wss://ws.finnhub.io?token=${this.state.key_id}`, this.streamListener)\n      //this.api = null\n    }\n  }\n\n  disconnect() {//TODO\n    //this.ws.disconnect()\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(List, {\n        positions: this.state.positions,\n        ws: this.ws,\n        streamData: this.state.streamData\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Control, {\n        key_id: this.state.key_id,\n        secret_key: this.state.secret_key,\n        ticker: this.state.ticker,\n        stream: this.state.stream,\n        p1: this.state.p1,\n        p2: this.state.p2,\n        idChange: this.idChange,\n        skChange: this.skChange,\n        tickerChange: this.tickerChange,\n        streamChange: this.streamChange,\n        p1Change: this.p1Change,\n        p2Change: this.p2Change,\n        pairSwap: this.pairSwap,\n        connect: this.connect\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default Main;","map":{"version":3,"sources":["/home/ruitai/alpaca/frontend/src/Components/main.js"],"names":["Component","Control","API","Stream","List","Main","constructor","props","tickerChange","bind","idChange","skChange","streamChange","p1Change","p2Change","pairSwap","streamListener","connect","initPositions","apiPositionListener","state","key_id","secret_key","stream","ticker","p1","p2","e","setState","target","value","p1Now","p2Now","msg","data","JSON","parse","message","console","log","ws","subscribe","streamData","positions","position","symbol","qty","avg_entry_price","api","get_positions","alert","disconnect","render"],"mappings":"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","sourcesContent":["import {Component} from \"react\";\nimport Control from './control';\nimport API from './apiHandler';\nimport Stream from \"./stream\";\n\nimport List from './list';\n\nclass Main extends Component{\n    constructor(props){\n        super(props);\n        //Values that get passed to the component\n\n        this.tickerChange = this.tickerChange.bind(this);\n        this.idChange = this.idChange.bind(this);\n        this.skChange = this.skChange.bind(this);\n        this.streamChange = this.streamChange.bind(this);\n\n        this.p1Change = this.p1Change.bind(this);\n        this.p2Change = this.p2Change.bind(this);\n        this.pairSwap = this.pairSwap.bind(this);\n\n        this.streamListener = this.streamListener.bind(this);\n        this.connect = this.connect.bind(this);\n\n        this.initPositions = this.initPositions.bind(this);\n        this.apiPositionListener = this.apiPositionListener.bind(this);\n\n        //this.subscribe = this.subscribe.bind(this);\n        //this.unsubscribe = this.unsubscribe.bind(this);\n\n        //this.initPositions = this.initPositions.bind(this);\n        //this.get_price = this.get_price.bind(this);\n\n        this.state = {\n            key_id: 'PK5YYD0RTSIBEH5O4IG7',\n            //key_id: 'bvqgf2n48v6qg460kck0',\n            secret_key: 'vbrBfUR0BkmsjtR13sB0mxqYOPQqaR67ARJoZO4P',\n\n            //positions: array of [Ticker, qty, avg price] arrays,\n\n            stream: 'stocks',\n            //stream: 'forex',\n            ticker: 'MSFT', // Ticker is the active window ticker symbol\n\n            p1: \"USD\",\n            p2: \"CAD\",\n        }\n    }\n\n    //#region Onchange Functions (Called from Control Panel)\n    //TODO: May need to update the websocket stream & also the api handler\n    //NOTE: Using this.state.[whatever] after setState doesn't seem to update it until the next iteration;\n    //Need to directly use e.target.value\n    tickerChange(e) {\n        this.setState({ticker: e.target.value})\n    }\n    idChange(e) {\n        this.setState({key_id: e.target.value});\n    }\n    skChange(e) {\n        this.setState({secret_key: e.target.value});\n    }\n\n    streamChange(e){\n        //TODO -> What should the behavior here be wrt to the currently active connections?\n        this.setState({stream: e.target.value})\n        //this.disconnect()\n\n        //url state is updated in connect()\n    }\n\n    //Currency Pair Related Functions\n    p1Change(e){\n        this.setState({p1: e.target.value})\n    }\n\n    p2Change(e){\n        this.setState({p2: e.target.value})\n    }\n\n    pairSwap(){\n        let p1Now = this.state.p1\n        let p2Now = this.state.p2\n        this.setState({p1: p2Now})\n        this.setState({p2: p1Now})\n    }\n    //#endregion\n\n    \n    streamListener(msg){ //websocket callback; parses incoming data and updates state\n        let data = JSON.parse(msg.data)\n        if (data[0].message != null){\n            console.log(data[0].message)\n            //initialize positions after authentication confirmation\n            if (data[0].message === 'authenticated'){\n                this.ws.subscribe(this.state.ticker)\n                this.initPositions()\n            }\n        }else{//Message is null, so we assume it is already subscribed to a stream\n            //console.log(JSON.stringify(data))\n            this.setState({streamData: data})\n        }\n    }\n\n    \n    apiPositionListener(msg){//Run only from initPositions\n        let positions = {} // Symbol: [qty, price]\n\n        for (let position of JSON.parse(msg)){\n            positions[position.symbol] = [position.qty, position.avg_entry_price]\n            this.ws.subscribe(position.symbol)\n        }\n\n        this.setState({positions: positions})\n        //console.log(this.state.positions)\n    }\n\n    initPositions(){\n        this.api.get_positions(this.apiPositionListener)\n    }\n\n    connect(){\n        //Creates new connections to API and Stream\n        if (this.state.stream === \"stocks\"){\n            this.ws = new Stream(this.state.key_id, 'wss://socket.polygon.io/stocks', this.streamListener)\n            this.api = new API(this.state.key_id, this.state.secret_key, 'https://paper-api.alpaca.markets')\n            this.initPositions()            \n        }else{\n            alert(\"Forex support coming soon!\")\n            this.setState({stream: \"stocks\"})\n            //this.ws = new Stream(this.state.key_id, `wss://ws.finnhub.io?token=${this.state.key_id}`, this.streamListener)\n            //this.api = null\n        }\n    }\n\n    disconnect(){\n        //TODO\n        //this.ws.disconnect()\n\n    }\n\n\n    render(){\n        return(\n            <div>\n                <List positions={this.state.positions} ws={this.ws} streamData={this.state.streamData}/>\n                <Control key_id={this.state.key_id} secret_key={this.state.secret_key} ticker={this.state.ticker} stream={this.state.stream} p1={this.state.p1} p2={this.state.p2} idChange={this.idChange} skChange={this.skChange} tickerChange={this.tickerChange} streamChange={this.streamChange} p1Change={this.p1Change} p2Change={this.p2Change} pairSwap={this.pairSwap} connect={this.connect}/>\n            </div>\n        )\n    }\n}\n\nexport default Main;"]},"metadata":{},"sourceType":"module"}